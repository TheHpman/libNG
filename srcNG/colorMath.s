	.include "srcNG/defines.inc"
	#include <configNG.h>
	.align	2


#if	COLORMATH_ENABLE

.globl	palBuffer
.globl	palHandles
.globl	palTransferPending
.globl	palCommandPending


	;* drgb RRRR GGGG BBBB
	;* expected: d0.w=0xf
	;* OUT > D2:R
	;*	 D3:G
	;*	 D4:B
	.macro	splitColor src
		move.b	(\src), d2		;* color MSB
		move.w	(\src)+, d1		;* whole color
		and.w	d0, d2			;* d2= RRRR
		move.w	d1, d3
		lsr.b	#4, d3
		and.w	d0, d3			;* d3= GGGG
		move.b	d1, d4
		and.w	d0, d4			;* d4= BBBB

		add.w	d1, d1
		add.w	d1, d1
		addx.b	d2, d2			;* d2 = RRRRr

		add.w	d1, d1
		addx.b	d3, d3			;* d3 = GGGGg

		add.w	d1, d1
		addx.b	d4, d4			;* d4 = BBBBb
	.endm


;* ******************************************************************************
;* 		void cMathSetCommand(u16 slot, u16 count, u16 cmd)
;* ******************************************************************************
.globl	cMathSetCommand
	.set	_ARGS, 4
	.set	_slot, _ARGS+2		;* word
	.set	_count, _ARGS+4+2	;* word
	.set	_cmd, _ARGS+8+2		;* word
cMathSetCommand:
		move.w	_slot(sp), d0
		move.w	d0, d1
		add.w	d0, d1
		add.w	d0, d1
		add.w	d1, d1			;* *slot *6

		move.w	_count(sp), d0
		beq.s	9f
		subq.w	#1, d0

		lea	palHandles, a0
		add.w	d1, a0			;* a0 = handles[slot]

		move.w	#0x80, d1
		or.w	_cmd(sp), d1

0:		move.w	d1, PH_ACC_CMD(a0)	;* set cmd
		addq.w	#SIZEOF_PALHANDLE, a0	;* slot++
		dbra	d0, 0b

		move.b	#1, palCommandPending
9:		rts


;* ******************************************************************************
;* 	void cMathLoadPalette(u16 slot, u16 count, u16 cmd, palette *pal)
;* ******************************************************************************
.globl	cMathLoadPalette
	.set	_ARGS, 4
	.set	_slot, _ARGS+2		;* word
	.set	_count, _ARGS+4+2	;* word
	.set	_cmd, _ARGS+8+2		;* word
	.set	_ptrPal, _ARGS+12	;* long
cMathLoadPalette:
		move.w	_slot(sp), d0
		move.w	d0, d1
		add.w	d0, d1
		add.w	d0, d1
		add.w	d1, d1			;* *slot *6

		move.w	_count(sp), d0
		beq.s	9f
		subq.w	#1, d0

		lea	palHandles, a0
		add.w	d1, a0			;* a0 = handles[slot]

		move.l	_ptrPal(sp), a1

		move.w	_cmd(sp), d1
	;*	or.w	#0x80, d1

0:		move.w	d1, (a0)+		;* set cmd
		move.l	a1, (a0)+		;* set pal ptr
		lea	16*2(a1), a1		;* pal++
		dbra	d0, 0b

		move.b	#1, palCommandPending
9:		rts


;* ******************************************************************************
;* 			void cMathFlushBlocks()
;*		- internal VBL call, registers can be trashed -
;* ******************************************************************************
.globl	cMathFlushBlocks

cMathFlushBlocks:
		lea	palBuffer, a0
		lea	PAL_RAM, a1
		moveq	#PAL_MAX_VBLBLKS-1, d1	;* max blocks per vbl
		moveq	#PAL_BLOCK_COUNT-1, d0	;* total blocks

_nextBlock:	tst.w	(a0)
		beq.w	_skipBlock
		dbra	d1, _copyBlock
		;* out of vbl budget
		move.b	d1, palTransferPending
		rts

_copyBlock:	clr.w	(a0)
;*	.rept	PAL_BLOCK_SIZE*8
;*		move.l	(a0)+, (a1)+
;*	.endr

	;*	4cy. faster but trashes registers
	.rept	PAL_BLOCK_SIZE
		movem.l	(a0)+, d2-d7/a2-a3
		movem.l	d2-d7/a2-a3, (a1)
		lea	16*2(a1), a1
	.endr

		dbra	d0, _nextBlock
		;* was last block, all done
		clr.b	palTransferPending
		rts

_skipBlock:	lea	PAL_BLOCK_SIZE*16*2(a0), a0
		lea	PAL_BLOCK_SIZE*16*2(a1), a1
		dbra	d0, _nextBlock
		;* all done
		clr.b	palTransferPending
		rts


;* ******************************************************************************
;* 			void cMathTickCommands()
;* ******************************************************************************
.globl	cMathTickCommands
cMathTickCommands:
		tst.b	palTransferPending	;* transfer pending?
		bne.s	9f
		tst.b	palCommandPending	;* commands pending?
		ble.s	9f

		clr.b	palCommandPending

		movem.l	d2-d7/a2-a6, -(sp)
		lea	palBuffer, a0
		lea	palHandles, a1
		lea	_greens(pc), a3

		moveq	#PAL_BLOCK_COUNT-1, d7	;* block counter

_nextBlk:	move.l	a0, a2			;* a2 = block start
		moveq	#PAL_BLOCK_SIZE-1, d6	;* block plaette counter

_checkCmd:	move.b	PH_CMD(a1), d0
		beq.s	_iterateCmd		;* no command
;*		bmi.w	_pal_set		;* load command

_doCmd:		and.w	#0x7c, d0
		jmp	cmdTable(pc,d0.w)

_iterateCmd:	lea	16*2(a0), a0		;* pal++
_iterateCmd2:	addq.w	#SIZEOF_PALHANDLE, a1	;* handle++
		dbra	d6, _checkCmd		;* handle iterate
		dbra	d7, _nextBlk		;* block iterate

		movem.l	(sp)+, d2-d7/a2-a6
9:		rts

;*_pal_set:	;* load pal as is
;*	#if	BANKING_ENABLE
;*		move.b	PH_PALADDR(a1), REG_BANKING
;*	#endif
;*		move.l	PH_PALADDR(a1), a6
;*
;*	.rept	8
;*		move.l	(a6)+, (a0)+	;* copy pal
;*	.endr
;*		lea	-32(a0), a0
;*		move.w	#1, (a2)	;* flag block for copy
;*		bra.s	_doCmd

_restorePal:	;* reset to base colors
	#if	BANKING_ENABLE
		move.b	PH_PALADDR(a1), REG_BANKING
	#endif
		move.l	PH_PALADDR(a1), a6
	.rept	8
		move.l	(a6)+, (a0)+	;* copy pal
	.endr
		clr.w	(a1)		;* clear cmd
		move.w	#1, (a2)	;* flag block for copy
		bra.s	_iterateCmd2

cmdTable:	;* fade commands
		jmp	_toBlack(pc)
		jmp	_fromBlack(pc)
		jmp	_blackFill(pc)
		jmp	_restorePal(pc)

		jmp	_toBlue(pc)
		jmp	_fromBlue(pc)
		jmp	_blueFill(pc)
		jmp	_restorePal(pc)

		jmp	_toGreen(pc)
		jmp	_fromGreen(pc)
		jmp	_greenFill(pc)
		jmp	_restorePal(pc)

		jmp	_toCyan(pc)
		jmp	_fromCyan(pc)
		jmp	_cyanFill(pc)
		jmp	_restorePal(pc)

		jmp	_toRed(pc)
		jmp	_fromRed(pc)
		jmp	_redFill(pc)
		jmp	_restorePal(pc)

		jmp	_toPurple(pc)
		jmp	_fromPurple(pc)
		jmp	_purpleFill(pc)
		jmp	_restorePal(pc)

		jmp	_toYellow(pc)
		jmp	_fromYellow(pc)
		jmp	_yellowFill(pc)
		jmp	_restorePal(pc)

		jmp	_toWhite(pc)
		jmp	_fromWhite(pc)
		jmp	_whiteFill(pc)
		jmp	_restorePal(pc)

		;* color fill commands
_blackFill:	move.l	#0x80008000, d0
		bra.s	_colorFill
_redFill:	move.l	#0x4f004f00, d0
		bra.s	_colorFill
_greenFill:	move.l	#0x20f020f0, d0
		bra.s	_colorFill
_blueFill:	move.l	#0x100f100f, d0
		bra.s	_colorFill
_yellowFill:	move.l	#0x6ff06ff0, d0	;* R+G
		bra.s	_colorFill
_purpleFill:	move.l	#0x5f0f5f0f, d0	;* R+B
		bra.s	_colorFill
_cyanFill:	move.l	#0x30ff30ff, d0	;* G+B
		bra.s	_colorFill
_whiteFill:	move.l	#0x7fff7fff, d0	;* R+G+B

_colorFill:
	.rept	8
		move.l	d0, (a0)+	;* no issue with reference color, as block 1st word will be 0'ed
	.endr
		clr.w	(a1)		;* clear cmd
		move.w	#1, (a2)	;* flag block for copy
		bra.w	_iterateCmd2

_fromBlack:
		lea	FROM_MIN(pc), a4
		lea	FROM_MIN(pc), a5
		lea	FROM_MIN(pc), a6
		bra.w	_computePalette
_toBlack:
		lea	TO_MIN(pc), a4
		lea	TO_MIN(pc), a5
		lea	TO_MIN(pc), a6
		bra.w	_computePalette
_fromBlue:
		lea	FROM_MIN(pc), a4
		lea	FROM_MIN(pc), a5
		lea	FROM_MAX(pc), a6
		bra.w	_computePalette
_toBlue:
		lea	TO_MIN(pc), a4
		lea	TO_MIN(pc), a5
		lea	TO_MAX(pc), a6
		bra.w	_computePalette
_fromGreen:
		lea	FROM_MIN(pc), a4
		lea	FROM_MAX(pc), a5
		lea	FROM_MIN(pc), a6
		bra.w	_computePalette
_toGreen:
		lea	TO_MIN(pc), a4
		lea	TO_MAX(pc), a5
		lea	TO_MIN(pc), a6
		bra.w	_computePalette
_fromCyan:
		lea	FROM_MIN(pc), a4
		lea	FROM_MAX(pc), a5
		lea	FROM_MAX(pc), a6
		bra.w	_computePalette
_toCyan:
		lea	TO_MIN(pc), a4
		lea	TO_MAX(pc), a5
		lea	TO_MAX(pc), a6
		bra.s	_computePalette
_fromRed:
		lea	FROM_MAX(pc), a4
		lea	FROM_MIN(pc), a5
		lea	FROM_MIN(pc), a6
		bra.s	_computePalette
_toRed:
		lea	TO_MAX(pc), a4
		lea	TO_MIN(pc), a5
		lea	TO_MIN(pc), a6
		bra.s	_computePalette
_fromPurple:
		lea	FROM_MAX(pc), a4
		lea	FROM_MIN(pc), a5
		lea	FROM_MAX(pc), a6
		bra.s	_computePalette
_toPurple:
		lea	TO_MAX(pc), a4
		lea	TO_MIN(pc), a5
		lea	TO_MAX(pc), a6
		bra.s	_computePalette
_fromYellow:
		lea	FROM_MAX(pc), a4
		lea	FROM_MAX(pc), a5
		lea	FROM_MIN(pc), a6
		bra.s	_computePalette
_toYellow:
		lea	TO_MAX(pc), a4
		lea	TO_MAX(pc), a5
		lea	TO_MIN(pc), a6
		bra.s	_computePalette
_fromWhite:
		lea	FROM_MAX(pc), a4
		lea	FROM_MAX(pc), a5
		lea	FROM_MAX(pc), a6
		bra.s	_computePalette
_toWhite:
		lea	TO_MAX(pc), a4
		lea	TO_MAX(pc), a5
		lea	TO_MAX(pc), a6
		bra.s	_computePalette

PAL_INC:
	.byte	256/CM_SPEED0, 256/CM_SPEED1
	.byte	256/CM_SPEED2, 256/CM_SPEED3

_computePalette:
		move.b	PH_ACC(a1), d0		;* d0= table index
		moveq	#3, d4			;* speed bits
		and.w	PH_ACC(a1), d4		;* word read, speed in cmd lsb
		move.b	PAL_INC(pc,d4.w), d5	;* d5= index mod
		add.b	d5, PH_ACC(a1)		;* acc+step
		bcs.s	_fadeOver

		move.b	#1, palCommandPending	;* command not done
		moveq	#7, d5
		and.b	d0, d5
		bne	_iterateCmd

		move.l	a1, -(sp)
	#if	BANKING_ENABLE
		move.b	PH_PALADDR(a1), REG_BANKING
	#endif
		move.l	PH_PALADDR(a1), a1
		addq.w	#2, a0		;* skip color #0
		addq.w	#2, a1
		add.w	d0, d0
		add.w	d0, d0
		lea	(a4,d0.w), a4
		lea	(a5,d0.w), a5
		lea	(a6,d0.w), a6

		moveq	#0xf, d0
		moveq	#15-1, d5

_computeColor:	splitColor a1			;* d2 d3 d4 = R G B
		move.b	(a4,d2.w), d2		;* R color index
		move.b	(a5,d3.w), d3		;* G color index
		move.b	(a6,d4.w), d4		;* B color index
		move.w	-64(a3,d2.w), d1	;* R value
		or.w	(a3,d3.w), d1		;* +G value
		or.w	64(a3,d4.w), d1		;* +B value
		move.w	d1, (a0)+
		dbra	d5, _computeColor	;* 12 sum 182cl= 15us
						;* 1 pal 230us

		move.w	#1, (a2)
		move.l	(sp)+, a1
		bra.w	_iterateCmd2

_fadeOver:	;* accumulator overflow, switch command
		or.w	#0b1001, PH_ACC(a1)
		bra.w	_checkCmd

_reds:
	.word	0x0000, 0x4000, 0x0100, 0x4100, 0x0200, 0x4200, 0x0300, 0x4300
	.word	0x0400, 0x4400, 0x0500, 0x4500, 0x0600, 0x4600, 0x0700, 0x4700
	.word	0x0800, 0x4800, 0x0900, 0x4900, 0x0a00, 0x4a00, 0x0b00, 0x4b00
	.word	0x0c00, 0x4c00, 0x0d00, 0x4d00, 0x0e00, 0x4e00, 0x0f00, 0x4f00
_greens:
	.word	0x0000, 0x2000, 0x0010, 0x2010, 0x0020, 0x2020, 0x0030, 0x2030
	.word	0x0040, 0x2040, 0x0050, 0x2050, 0x0060, 0x2060, 0x0070, 0x2070
	.word	0x0080, 0x2080, 0x0090, 0x2090, 0x00a0, 0x20a0, 0x00b0, 0x20b0
	.word	0x00c0, 0x20c0, 0x00d0, 0x20d0, 0x00e0, 0x20e0, 0x00f0, 0x20f0
_blues:
	.word	0x0000, 0x1000, 0x0001, 0x1001, 0x0002, 0x1002, 0x0003, 0x1003
	.word	0x0004, 0x1004, 0x0005, 0x1005, 0x0006, 0x1006, 0x0007, 0x1007
	.word	0x0008, 0x1008, 0x0009, 0x1009, 0x000a, 0x100a, 0x000b, 0x100b
	.word	0x000c, 0x100c, 0x000d, 0x100d, 0x000e, 0x100e, 0x000f, 0x100f

TO_MIN: ;* fade out color to black
	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e
	.byte	0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e
	.byte	0x20, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c
	.byte	0x2e, 0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e
	.byte	0x10, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c
	.byte	0x1e, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c
	.byte	0x2e, 0x2e, 0x30, 0x32, 0x34, 0x36, 0x38, 0x3a

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c
	.byte	0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a
	.byte	0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34, 0x36, 0x38

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18, 0x1a
	.byte	0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x26, 0x28
	.byte	0x2a, 0x2c, 0x2e, 0x30, 0x32, 0x32, 0x34, 0x36

	.byte	0x00, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a
	.byte	0x1c, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x26, 0x26
	.byte	0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18
	.byte	0x1a, 0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26
	.byte	0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0e, 0x10, 0x12, 0x12, 0x14, 0x16, 0x18
	.byte	0x1a, 0x1a, 0x1c, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x2e, 0x30

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x16
	.byte	0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22, 0x22
	.byte	0x24, 0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x2e

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x08, 0x08, 0x0a
	.byte	0x0c, 0x0c, 0x0e, 0x10, 0x12, 0x12, 0x14, 0x16
	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x26, 0x28, 0x2a, 0x2c, 0x2c

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a
	.byte	0x0c, 0x0c, 0x0e, 0x10, 0x10, 0x12, 0x14, 0x14
	.byte	0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20
	.byte	0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x2a, 0x2a

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a
	.byte	0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x12, 0x14
	.byte	0x16, 0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e
	.byte	0x20, 0x20, 0x22, 0x24, 0x24, 0x26, 0x28, 0x28

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x08
	.byte	0x0a, 0x0c, 0x0c, 0x0e, 0x10, 0x10, 0x12, 0x12
	.byte	0x14, 0x16, 0x16, 0x18, 0x1a, 0x1a, 0x1c, 0x1c
	.byte	0x1e, 0x20, 0x20, 0x22, 0x24, 0x24, 0x26, 0x26

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x10, 0x12
	.byte	0x14, 0x14, 0x16, 0x16, 0x18, 0x18, 0x1a, 0x1c
	.byte	0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x22, 0x24, 0x24

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10, 0x10
	.byte	0x12, 0x14, 0x14, 0x16, 0x16, 0x18, 0x18, 0x1a
	.byte	0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20, 0x22, 0x22

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10
	.byte	0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x18, 0x18
	.byte	0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10
	.byte	0x10, 0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x18
	.byte	0x18, 0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06
	.byte	0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e
	.byte	0x10, 0x10, 0x10, 0x12, 0x12, 0x14, 0x14, 0x16
	.byte	0x16, 0x18, 0x18, 0x1a, 0x1a, 0x1c, 0x1c, 0x1e

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06
	.byte	0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e
	.byte	0x0e, 0x0e, 0x10, 0x10, 0x12, 0x12, 0x14, 0x14
	.byte	0x16, 0x16, 0x16, 0x18, 0x18, 0x1a, 0x1a, 0x1c

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x04, 0x06
	.byte	0x06, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c
	.byte	0x0e, 0x0e, 0x0e, 0x10, 0x10, 0x12, 0x12, 0x12
	.byte	0x14, 0x14, 0x16, 0x16, 0x16, 0x18, 0x18, 0x1a

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x04, 0x06
	.byte	0x06, 0x06, 0x08, 0x08, 0x0a, 0x0a, 0x0a, 0x0c
	.byte	0x0c, 0x0c, 0x0e, 0x0e, 0x10, 0x10, 0x10, 0x12
	.byte	0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x16, 0x18

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0c, 0x0c, 0x0e, 0x0e, 0x0e, 0x10, 0x10
	.byte	0x10, 0x12, 0x12, 0x12, 0x14, 0x14, 0x14, 0x16

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x0a
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0e, 0x0e, 0x0e
	.byte	0x10, 0x10, 0x10, 0x10, 0x12, 0x12, 0x12, 0x14

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04
	.byte	0x04, 0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0c
	.byte	0x0e, 0x0e, 0x0e, 0x10, 0x10, 0x10, 0x10, 0x12

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04
	.byte	0x04, 0x04, 0x06, 0x06, 0x06, 0x06, 0x08, 0x08
	.byte	0x08, 0x08, 0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c
	.byte	0x0c, 0x0c, 0x0e, 0x0e, 0x0e, 0x0e, 0x10, 0x10

	.byte	0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04
	.byte	0x04, 0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06
	.byte	0x08, 0x08, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0a
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0c, 0x0e, 0x0e

	.byte	0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x06, 0x06
	.byte	0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c

	.byte	0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x08
	.byte	0x08, 0x08, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0a

	.byte	0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04, 0x04
	.byte	0x04, 0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06
	.byte	0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x08

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04
	.byte	0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06, 0x06

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

FROM_MIN: ;* fade in color from black
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04

	.byte	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04
	.byte	0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06, 0x06

	.byte	0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04, 0x04
	.byte	0x04, 0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06
	.byte	0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x08

	.byte	0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02
	.byte	0x02, 0x02, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x08
	.byte	0x08, 0x08, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0a

	.byte	0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02
	.byte	0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x06, 0x06
	.byte	0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c

	.byte	0x00, 0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04
	.byte	0x04, 0x04, 0x04, 0x04, 0x06, 0x06, 0x06, 0x06
	.byte	0x08, 0x08, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0a
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0c, 0x0e, 0x0e

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04
	.byte	0x04, 0x04, 0x06, 0x06, 0x06, 0x06, 0x08, 0x08
	.byte	0x08, 0x08, 0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c
	.byte	0x0c, 0x0c, 0x0e, 0x0e, 0x0e, 0x0e, 0x10, 0x10

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04
	.byte	0x04, 0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0c
	.byte	0x0e, 0x0e, 0x0e, 0x10, 0x10, 0x10, 0x10, 0x12

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x0a
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0c, 0x0e, 0x0e, 0x0e
	.byte	0x10, 0x10, 0x10, 0x10, 0x12, 0x12, 0x12, 0x14

	.byte	0x00, 0x00, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04
	.byte	0x06, 0x06, 0x06, 0x08, 0x08, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0c, 0x0c, 0x0e, 0x0e, 0x0e, 0x10, 0x10
	.byte	0x10, 0x12, 0x12, 0x12, 0x14, 0x14, 0x14, 0x16

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x04, 0x06
	.byte	0x06, 0x06, 0x08, 0x08, 0x0a, 0x0a, 0x0a, 0x0c
	.byte	0x0c, 0x0c, 0x0e, 0x0e, 0x10, 0x10, 0x10, 0x12
	.byte	0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x16, 0x18

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x04, 0x06
	.byte	0x06, 0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c
	.byte	0x0e, 0x0e, 0x0e, 0x10, 0x10, 0x12, 0x12, 0x12
	.byte	0x14, 0x14, 0x16, 0x16, 0x16, 0x18, 0x18, 0x1a

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06
	.byte	0x08, 0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e
	.byte	0x0e, 0x0e, 0x10, 0x10, 0x12, 0x12, 0x14, 0x14
	.byte	0x16, 0x16, 0x16, 0x18, 0x18, 0x1a, 0x1a, 0x1c

	.byte	0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06
	.byte	0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e
	.byte	0x10, 0x10, 0x10, 0x12, 0x12, 0x14, 0x14, 0x16
	.byte	0x16, 0x18, 0x18, 0x1a, 0x1a, 0x1c, 0x1c, 0x1e

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10
	.byte	0x10, 0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x18
	.byte	0x18, 0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10
	.byte	0x12, 0x12, 0x14, 0x14, 0x16, 0x16, 0x18, 0x18
	.byte	0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, 0x08
	.byte	0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e, 0x10, 0x10
	.byte	0x12, 0x14, 0x14, 0x16, 0x16, 0x18, 0x18, 0x1a
	.byte	0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20, 0x22, 0x22

	.byte	0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x08, 0x08
	.byte	0x0a, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x10, 0x12
	.byte	0x14, 0x14, 0x16, 0x16, 0x18, 0x18, 0x1a, 0x1c
	.byte	0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x22, 0x24, 0x24

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x08
	.byte	0x0a, 0x0c, 0x0c, 0x0e, 0x10, 0x10, 0x12, 0x12
	.byte	0x14, 0x16, 0x16, 0x18, 0x1a, 0x1a, 0x1c, 0x1c
	.byte	0x1e, 0x20, 0x20, 0x22, 0x24, 0x24, 0x26, 0x26

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a
	.byte	0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x12, 0x14
	.byte	0x16, 0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e
	.byte	0x20, 0x20, 0x22, 0x24, 0x24, 0x26, 0x28, 0x28

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a
	.byte	0x0c, 0x0c, 0x0e, 0x10, 0x10, 0x12, 0x14, 0x14
	.byte	0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20
	.byte	0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x2a, 0x2a

	.byte	0x00, 0x02, 0x02, 0x04, 0x06, 0x08, 0x08, 0x0a
	.byte	0x0c, 0x0c, 0x0e, 0x10, 0x12, 0x12, 0x14, 0x16
	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x26, 0x28, 0x2a, 0x2c, 0x2c

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x16
	.byte	0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22, 0x22
	.byte	0x24, 0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x2e

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0a
	.byte	0x0c, 0x0e, 0x10, 0x12, 0x12, 0x14, 0x16, 0x18
	.byte	0x1a, 0x1a, 0x1c, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x2e, 0x30

	.byte	0x00, 0x02, 0x04, 0x04, 0x06, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18
	.byte	0x1a, 0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26
	.byte	0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32

	.byte	0x00, 0x02, 0x04, 0x06, 0x06, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a
	.byte	0x1c, 0x1c, 0x1e, 0x20, 0x22, 0x24, 0x26, 0x26
	.byte	0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x08, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18, 0x1a
	.byte	0x1c, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x26, 0x28
	.byte	0x2a, 0x2c, 0x2e, 0x30, 0x32, 0x32, 0x34, 0x36

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0a, 0x0c
	.byte	0x0e, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c
	.byte	0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a
	.byte	0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34, 0x36, 0x38

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e
	.byte	0x10, 0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c
	.byte	0x1e, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c
	.byte	0x2e, 0x2e, 0x30, 0x32, 0x34, 0x36, 0x38, 0x3a

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e
	.byte	0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e
	.byte	0x20, 0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c
	.byte	0x2e, 0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c

	.byte	0x00, 0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e
	.byte	0x10, 0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e
	.byte	0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e
	.byte	0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

TO_MAX:	;* from color to white
	.byte	0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10
	.byte	0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20
	.byte	0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e
	.byte	0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10, 0x12
	.byte	0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20
	.byte	0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12
	.byte	0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x32, 0x34, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x08, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14
	.byte	0x16, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x24, 0x26, 0x28, 0x2a, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x32, 0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16
	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x22, 0x24
	.byte	0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x2e, 0x30
	.byte	0x32, 0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16, 0x18
	.byte	0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x32
	.byte	0x32, 0x34, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3e

	.byte	0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18
	.byte	0x1a, 0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26
	.byte	0x26, 0x28, 0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x32
	.byte	0x34, 0x34, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3e

	.byte	0x10, 0x12, 0x12, 0x14, 0x16, 0x18, 0x18, 0x1a
	.byte	0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x26
	.byte	0x28, 0x2a, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32
	.byte	0x34, 0x36, 0x36, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x12, 0x12, 0x14, 0x16, 0x18, 0x18, 0x1a, 0x1c
	.byte	0x1c, 0x1e, 0x20, 0x22, 0x22, 0x24, 0x26, 0x28
	.byte	0x28, 0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x32, 0x32
	.byte	0x34, 0x36, 0x36, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x14, 0x14, 0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1e
	.byte	0x1e, 0x20, 0x22, 0x22, 0x24, 0x26, 0x26, 0x28
	.byte	0x2a, 0x2a, 0x2c, 0x2e, 0x2e, 0x30, 0x32, 0x34
	.byte	0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x16, 0x16, 0x18, 0x1a, 0x1a, 0x1c, 0x1e, 0x1e
	.byte	0x20, 0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x2a
	.byte	0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34
	.byte	0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20
	.byte	0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a
	.byte	0x2c, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x32, 0x34
	.byte	0x36, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a, 0x2c
	.byte	0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x32, 0x34, 0x34
	.byte	0x36, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x24, 0x26, 0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2c
	.byte	0x2e, 0x2e, 0x30, 0x30, 0x32, 0x32, 0x34, 0x36
	.byte	0x36, 0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x1e, 0x1e, 0x20, 0x20, 0x22, 0x22, 0x24, 0x24
	.byte	0x26, 0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2c, 0x2e
	.byte	0x2e, 0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36
	.byte	0x36, 0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x20, 0x20, 0x22, 0x22, 0x24, 0x24, 0x26, 0x26
	.byte	0x28, 0x28, 0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e
	.byte	0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x20, 0x22, 0x22, 0x24, 0x24, 0x26, 0x26, 0x28
	.byte	0x28, 0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e, 0x30
	.byte	0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x22, 0x24, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a
	.byte	0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e, 0x30, 0x30
	.byte	0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36, 0x38
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x24, 0x26, 0x26, 0x28, 0x28, 0x28, 0x2a, 0x2a
	.byte	0x2c, 0x2c, 0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x32
	.byte	0x32, 0x32, 0x34, 0x34, 0x36, 0x36, 0x36, 0x38
	.byte	0x38, 0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2a, 0x2c, 0x2c
	.byte	0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x30, 0x32, 0x32
	.byte	0x32, 0x34, 0x34, 0x36, 0x36, 0x36, 0x38, 0x38
	.byte	0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x28, 0x2a, 0x2a, 0x2a, 0x2c, 0x2c, 0x2c, 0x2e
	.byte	0x2e, 0x2e, 0x30, 0x30, 0x30, 0x32, 0x32, 0x34
	.byte	0x34, 0x34, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x2a, 0x2c, 0x2c, 0x2c, 0x2e, 0x2e, 0x2e, 0x30
	.byte	0x30, 0x30, 0x30, 0x32, 0x32, 0x32, 0x34, 0x34
	.byte	0x34, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x2c, 0x2e, 0x2e, 0x2e, 0x2e, 0x30, 0x30, 0x30
	.byte	0x32, 0x32, 0x32, 0x32, 0x34, 0x34, 0x34, 0x36
	.byte	0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x2e, 0x30, 0x30, 0x30, 0x30, 0x32, 0x32, 0x32
	.byte	0x32, 0x34, 0x34, 0x34, 0x34, 0x36, 0x36, 0x36
	.byte	0x36, 0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x30, 0x30, 0x32, 0x32, 0x32, 0x32, 0x34, 0x34
	.byte	0x34, 0x34, 0x34, 0x36, 0x36, 0x36, 0x36, 0x38
	.byte	0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x32, 0x32, 0x34, 0x34, 0x34, 0x34, 0x34, 0x36
	.byte	0x36, 0x36, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x34, 0x34, 0x34, 0x36, 0x36, 0x36, 0x36, 0x36
	.byte	0x36, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x38, 0x38
	.byte	0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x38, 0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

FROM_MAX: ;* fade to color from white
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e
	.byte	0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x38, 0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x38, 0x38
	.byte	0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x34, 0x34, 0x34, 0x36, 0x36, 0x36, 0x36, 0x36
	.byte	0x36, 0x38, 0x38, 0x38, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e, 0x3e

	.byte	0x32, 0x32, 0x34, 0x34, 0x34, 0x34, 0x34, 0x36
	.byte	0x36, 0x36, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a, 0x3a, 0x3c
	.byte	0x3c, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x30, 0x30, 0x32, 0x32, 0x32, 0x32, 0x34, 0x34
	.byte	0x34, 0x34, 0x34, 0x36, 0x36, 0x36, 0x36, 0x38
	.byte	0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x2e, 0x30, 0x30, 0x30, 0x30, 0x32, 0x32, 0x32
	.byte	0x32, 0x34, 0x34, 0x34, 0x34, 0x36, 0x36, 0x36
	.byte	0x36, 0x38, 0x38, 0x38, 0x38, 0x3a, 0x3a, 0x3a
	.byte	0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e, 0x3e

	.byte	0x2c, 0x2e, 0x2e, 0x2e, 0x2e, 0x30, 0x30, 0x30
	.byte	0x32, 0x32, 0x32, 0x32, 0x34, 0x34, 0x34, 0x36
	.byte	0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x2a, 0x2c, 0x2c, 0x2c, 0x2e, 0x2e, 0x2e, 0x30
	.byte	0x30, 0x30, 0x30, 0x32, 0x32, 0x32, 0x34, 0x34
	.byte	0x34, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38, 0x3a
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x28, 0x2a, 0x2a, 0x2a, 0x2c, 0x2c, 0x2c, 0x2e
	.byte	0x2e, 0x2e, 0x30, 0x30, 0x30, 0x32, 0x32, 0x34
	.byte	0x34, 0x34, 0x36, 0x36, 0x36, 0x38, 0x38, 0x38
	.byte	0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2a, 0x2c, 0x2c
	.byte	0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x30, 0x32, 0x32
	.byte	0x32, 0x34, 0x34, 0x36, 0x36, 0x36, 0x38, 0x38
	.byte	0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x24, 0x26, 0x26, 0x28, 0x28, 0x28, 0x2a, 0x2a
	.byte	0x2c, 0x2c, 0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x32
	.byte	0x32, 0x32, 0x34, 0x34, 0x36, 0x36, 0x36, 0x38
	.byte	0x38, 0x3a, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x22, 0x24, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a
	.byte	0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e, 0x30, 0x30
	.byte	0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36, 0x38
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x20, 0x22, 0x22, 0x24, 0x24, 0x26, 0x26, 0x28
	.byte	0x28, 0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e, 0x30
	.byte	0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x20, 0x20, 0x22, 0x22, 0x24, 0x24, 0x26, 0x26
	.byte	0x28, 0x28, 0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e
	.byte	0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36
	.byte	0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e

	.byte	0x1e, 0x1e, 0x20, 0x20, 0x22, 0x22, 0x24, 0x24
	.byte	0x26, 0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2c, 0x2e
	.byte	0x2e, 0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36
	.byte	0x36, 0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x1c, 0x1c, 0x1e, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x24, 0x26, 0x26, 0x28, 0x28, 0x2a, 0x2a, 0x2c
	.byte	0x2e, 0x2e, 0x30, 0x30, 0x32, 0x32, 0x34, 0x36
	.byte	0x36, 0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a, 0x2c
	.byte	0x2c, 0x2e, 0x2e, 0x30, 0x30, 0x32, 0x34, 0x34
	.byte	0x36, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e, 0x20
	.byte	0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x28, 0x2a
	.byte	0x2c, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x32, 0x34
	.byte	0x36, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x16, 0x16, 0x18, 0x1a, 0x1a, 0x1c, 0x1e, 0x1e
	.byte	0x20, 0x22, 0x22, 0x24, 0x26, 0x26, 0x28, 0x2a
	.byte	0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x30, 0x32, 0x34
	.byte	0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x14, 0x14, 0x16, 0x18, 0x18, 0x1a, 0x1c, 0x1e
	.byte	0x1e, 0x20, 0x22, 0x22, 0x24, 0x26, 0x26, 0x28
	.byte	0x2a, 0x2a, 0x2c, 0x2e, 0x2e, 0x30, 0x32, 0x34
	.byte	0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x12, 0x12, 0x14, 0x16, 0x18, 0x18, 0x1a, 0x1c
	.byte	0x1c, 0x1e, 0x20, 0x22, 0x22, 0x24, 0x26, 0x28
	.byte	0x28, 0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x32, 0x32
	.byte	0x34, 0x36, 0x36, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x10, 0x12, 0x12, 0x14, 0x16, 0x18, 0x18, 0x1a
	.byte	0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x24, 0x26
	.byte	0x28, 0x2a, 0x2a, 0x2c, 0x2e, 0x30, 0x30, 0x32
	.byte	0x34, 0x36, 0x36, 0x38, 0x3a, 0x3c, 0x3c, 0x3e

	.byte	0x0e, 0x10, 0x10, 0x12, 0x14, 0x16, 0x16, 0x18
	.byte	0x1a, 0x1c, 0x1e, 0x1e, 0x20, 0x22, 0x24, 0x26
	.byte	0x26, 0x28, 0x2a, 0x2c, 0x2c, 0x2e, 0x30, 0x32
	.byte	0x34, 0x34, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3e

	.byte	0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16, 0x18
	.byte	0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x20, 0x22, 0x24
	.byte	0x26, 0x28, 0x28, 0x2a, 0x2c, 0x2e, 0x30, 0x32
	.byte	0x32, 0x34, 0x36, 0x38, 0x3a, 0x3a, 0x3c, 0x3e

	.byte	0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14, 0x16
	.byte	0x18, 0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x22, 0x24
	.byte	0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x2e, 0x30
	.byte	0x32, 0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x08, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12, 0x14
	.byte	0x16, 0x18, 0x1a, 0x1c, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x24, 0x26, 0x28, 0x2a, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x32, 0x34, 0x36, 0x38, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x0e, 0x10, 0x12
	.byte	0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20, 0x22
	.byte	0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x32, 0x34, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10, 0x12
	.byte	0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20
	.byte	0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e, 0x30
	.byte	0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e

	.byte	0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10
	.byte	0x12, 0x14, 0x16, 0x18, 0x1a, 0x1c, 0x1e, 0x20
	.byte	0x20, 0x22, 0x24, 0x26, 0x28, 0x2a, 0x2c, 0x2e
	.byte	0x30, 0x32, 0x34, 0x36, 0x38, 0x3a, 0x3c, 0x3e



;* ******************************************************************************
;* 	void cMathPalEffect(u16 *srcPal, u16 *dstPal, u32 effect_count, u32 effectColor);
;* ******************************************************************************

.globl	cMathPalEffect
	.set	_ARGS, 4+(2*4)+(6*2)
	.set	_srcPal, _ARGS		;* long
	.set	_dstPal, _ARGS+4	;* long
	.set	_effect, _ARGS+8	;* word
	.set	_count, _ARGS+8+2	;* word
	.set	_colorR, _ARGS+12+1	;* byte
	.set	_colorG, _ARGS+12+2	;* byte
	.set	_colorB, _ARGS+12+3	;* byte

cMathPalEffect:
		;* save registers
		movem.w	d2-d7, -(sp)
		move.l	a2, -(sp)
		move.l	a3, -(sp)

		;* bankswitch
	#if	BANKING_ENABLE
		move.b	_srcPal(sp), REG_BANKING
	#endif

		;* setup args
		move.w	_count(sp), d1
		beq.s	9f
		subq.w	#1, d1
		move.l	_srcPal(sp), a0
		move.l	_dstPal(sp), a1
		lea	_greens(pc), a2

		move.b	_colorR(sp), d5
		move.b	_colorG(sp), d6
		move.b	_colorB(sp), d7

		;* setup effect ptr
		move.w	_effect(sp), d0
		move.l	_effects(pc,d0.w), a3

		;* process palette
_nxtPal:	move.w	(a0)+, (a1)+	;* color #0
		move.l	#(0xf<<16)+15-1, d0
		swap	d1		;* save pal count

		;* process color
_nxtColor:	swap	d0		;* save color count
		splitColor a0		;* d2 d3 d4 = R G B
		jmp	(a3)

_effects:
	.long	effect_xor
	.long	effect_add
	.long	effect_addHalf
	.long	effect_sub
	.long	effect_subHalf
	.long	effect_desaturate

	.macro	iteratePalEffect
		;* iterate color
		swap	d0		;* restore color count
		dbra	d0, _nxtColor
		;* iterate palette
		swap	d1		;* restore pal count
		dbra	d1, _nxtPal
		;* all finished
		bra	9b
	.endm

		;* restore registers
9:		move.l	(sp)+, a3
		move.l	(sp)+, a2
	;*	movem.w	(sp)+, d2-d7	;* nope, sign extends data registers!
		move.w	(sp)+, d2
		move.w	(sp)+, d3
		move.w	(sp)+, d4
		move.w	(sp)+, d5
		move.w	(sp)+, d6
		move.w	(sp)+, d7
		rts


effect_xor:
		;* xor colors
		eor.b	d5, d2
		add.b	d2, d2
		move.w	-64(a2,d2.w), d2	;* final R
		eor.b	d6, d3
		add.b	d3, d3
		or.w	(a2,d3.w), d2		;* final R+G
		eor.b	d7, d4
		add.b	d4, d4
		or.w	64(a2,d4.w), d2		;* final R+G+B
		move.w	d2, (a1)+
		iteratePalEffect

effect_add:
		;* color addition
		move.w	#0x1f, d1
		add.b	d5, d2
		cmp.b	d1, d2
		ble.s	0f
		move.b	d1, d2
0:		add.w	d2, d2
		move.w	-64(a2,d2.w), d2	;* final R
		add.b	d6, d3
		cmp.b	d1, d3
		ble.s	0f
		move.b	d1, d3
0:		add.w	d3, d3
		or.w	(a2,d3.w), d2		;* final R+G
		add.b	d7, d4
		cmp.b	d1, d4
		ble.s	0f
		move.b	d1, d4
0:		add.w	d4, d4
		or.w	64(a2,d4.w), d2		;* final R+G+B
		move.w	d2, (a1)+
		iteratePalEffect

effect_addHalf:
		;* add + half (half is implicit by word data)
		move.w	#0x3e, d1
		add.b	d5, d2
		and.w	d1, d2
		move.w	-64(a2,d2.w), d2	;* final R
		add.b	d6, d3
		and.w	d1, d3
		or.w	(a2,d3.w), d2		;* final R+G
		add.b	d7, d4
		and.w	d1, d4
		or.w	64(a2,d4.w), d2		;* final R+G+B
		move.w	d2, (a1)+
		iteratePalEffect

effect_sub:
		;* color substraction
		sub.b	d5, d2
		bcc.s	0f
		clr.b	d2
0:		add.w	d2, d2
		move.w	-64(a2,d2.w), d2	;* final R

		sub.b	d6, d3
		bls.s	0f
		add.w	d3, d3
		or.w	(a2,d3.w), d2		;* final R+G

0:		sub.b	d7, d4
		bls.s	0f
		add.w	d4, d4
		or.w	64(a2,d4.w), d2		;* final R+G+B

0:		move.w	d2, (a1)+
		iteratePalEffect

effect_subHalf:
		;* color substraction + half
		move.w	#0x3e, d1
		sub.b	d5, d2
		bcc.s	0f
		clr.b	d2
0:		and.w	d1, d2
		move.w	-64(a2,d2.w), d2	;* final R

		sub.b	d6, d3
		bls.s	0f
		and.w	d1, d3
		or.w	(a2,d3.w), d2		;* final R+G

0:		sub.b	d7, d4
		bls.s	0f
		and.w	d1, d4
		or.w	64(a2,d4.w), d2		;* final R+G+B

0:		move.w	d2, (a1)+
		iteratePalEffect



	.macro	fTable factor
	.set	_color, 0
	.rept	32
	.word	(((_color<<11)*\factor)/10)
	.set	_color, _color+1
	.endr
	.endm

_r03:	fTable 3

;*	f = 0.2; // desaturate by 20%
;*	L = 0.3*r + 0.6*g + 0.1*b;
;*	new_r = r + f * (L - r);
;*	new_g = g + f * (L - g);
;*	new_b = b + f * (L - b);
;*	doing factor 1.0 for now...

effect_desaturate:
		add.w	d2, d2
		move.w	_r03(pc,d2.w), d1
		add.w	d3, d3
		add.w	_g06(pc,d3.w), d1
		add.w	d4, d4
		add.w	_b01(pc,d4.w), d1
		lsr.w	#8, d1
		addq.w	#4, d1		;* round up
		lsr.w	#2, d1
		and.w	#~1, d1		;* d1=L*2

		move.w	-64(a2,d1.w), d2
		or.w	(a2,d1.w), d2
		or.w	64(a2,d1.w), d2
		move.w	d2, (a1)+

		iteratePalEffect

_g06:	fTable 6
_b01:	fTable 1


;* COLORMATH_ENABLE
#endif
